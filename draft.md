以下是根据提供的文档内容整改形成的回溯报告，补充了时间线和必要内容：

---

# **金域医学OBS归档数据重复取回事件回溯报告**

## 1. 报告概述
**事件主题**：OBS Util工具重复取回归档数据导致异常计费  
**影响客户**：金域医学（账号：jnkingmed）  
**故障时间**：2025年6月21日 03:00 - 20:00  
**经济损失**：多扣费 6,850.80 元（中国站）  
**根本原因**：OBS Util工具缺乏重复取回防呆机制  
**解决状态**：账单逆向调整中，技术方案已实施  

---

## 2. 事件背景
客户使用 **OBS Util命令行工具** 对 `ngsbak` 桶执行归档数据取回操作时，因工具设计缺陷，在自动重试过程中**重复取回已恢复的归档对象**，导致：
- 多取回数据量：202 TB  
- 产生计划外费用：6,850.80 元  
- 触发账号欠费，影响业务资源可用性  

---

## 3. 事件时间线
| **时间节点**         | **关键事件**                                                                 |
|----------------------|-----------------------------------------------------------------------------|
| **2025-06-21 03:00** | 客户首次执行`restore`命令，部分任务失败                                     |
| **2025-06-21 03:XX** | OBS Util自动重试失败任务，**未跳过已取回对象**，触发重复计费                |
| **2025-06-21 20:00** | 异常操作结束，累计多取回202TB数据                                           |
| **2025-06-23**       | 客户提报故障（SRE事件单号：20250623000281），要求优先恢复账号可用性         |
| **2025-06-24**       | 华为技术团队确认根因：工具无重复任务防呆机制                                |
| **2025-06-25**       | 实施临时解决方案：**通过OBS SDK单独识别并取回未恢复对象**（已完成）         |
| **2025-07-XX**       | 产品部正式确认根因归属工具设计缺陷                                          |
| **2025-07-29**       | 提交账单逆向申请，编制本回溯报告                                            |

---

## 4. 根因分析
| **层级**       | **具体原因**                                                                 |
|----------------|-----------------------------------------------------------------------------|
| **直接原因**   | OBS Util在重试`restore`命令时，未检测已取回对象，导致重复执行               |
| **设计缺陷**   | 工具未实现"任务状态校验"逻辑，官网文档未警示重复调用风险                    |
| **触发条件**   | 首次执行存在部分失败任务 → 触发自动重试 → 重试过程无对象去重机制            |
| **产品责任**   | 经产品部确认：**后端服务未对重复任务做防呆处理**（见问题描述第5点）          |

> ![根因验证截图](media/image2.png)  
> *（附：产品部确认后端设计缺陷的沟通记录）*

---

## 5. 影响范围
| **维度**         | **影响详情**                                                                 |
|------------------|-----------------------------------------------------------------------------|
| **财务影响**     | 多扣费 6,850.80 元，导致账号欠费                                            |
| **业务影响**     | 欠费期间资源可用性受损（具体服务未说明）                                    |
| **客户类型**     | 故障期间实际客户类型：**直销客户**                                          |
| **数据流水**     | 涉及异常消费流水见附件：[media/image3.emf], [media/image4.emf]              |

---

## 6. 解决方案
1. **紧急措施**（已完成）  
   - 使用OBS SDK替代OBS Util，精准识别未取回对象并执行恢复  
   - 恢复账号可用性，解除欠费状态  

2. **财务调整**（进行中）  
   - 发起账单逆向流程，申请退还多扣费用 **6,850.80元**  

---

## 7. 改进措施
| **措施**                          | **责任人** | **截止时间** | **状态**   | **验收标准**                     |
|-----------------------------------|------------|--------------|------------|----------------------------------|
| 官网补充重复取回风险说明          | 巫城其     | 2025-07-31   | 未完成     | 文档发布至OBS Util使用指南       |
| OBS Util工具增加取回对象去重机制  | 巫城其     | 2025-09-30   | 未完成     | 工具版本更新，通过自动化测试用例 |

---

## 8. 经验总结
1. **工具设计需强化边界场景覆盖**：CLI工具需预设重试、中断等异常流程的防呆策略  
2. **文档风险提示缺失**：关键操作应在文档中明确标注潜在计费风险场景  
3. **客户操作监控机制**：对大流量操作建议增加实时费用预警能力  

> **附件**  
> 1. 异常消费流水凭证：[media/image3.emf], [media/image4.emf]  
> 2. SRE事件单记录：20250623000281  

---
**报告编制人**：XXX  
**最后更新日期**：2025年7月29日  

---

### 关键补充说明
1. **时间线重构**：明确分阶段记录从故障发生到根因确认的全过程  
2. **责任闭环**：将改进措施绑定责任人/时间节点，强化可追溯性  
3. **证据链完善**：引用事件单号、截图等作为根因佐证  
4. **客户类型标注**：按要求明确故障期间客户类型为"直销"  
5. **附件结构化**：规范引用文档中的图像证据
